# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных
Карточка товара
```typescript
export interface IItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```
Каталог товаров
```typescript
export interface ICatalog {
  total: number;
  items: IItem[];
}
```
Заказ
```typescript
export interface IOrder {
  payment: TPayment | undefined;
  email: string;
  phone: string;
  address: string;
  total: number | null;
  items: IItem[];
  ordered: TOrderedItems;
}
```
Ответ сервера об успешном заказе
```typescript
export interface IOrderResult {
  id: string;
  total: number | null;
}
```
Ответ сервера об ошибке
```typescript
export interface IErrorResponse {
  error: string;
}
```
Тип оплаты заказа
```typescript
export type TPayment = 'online' | 'offline';
```
Данные заказа, используемые в форме об оплате
```typescript
export type TOrderInfo = Pick<IOrder, 'payment' | 'address'>;
```
Данные заказа, используемые в форме контактной информации
```typescript
export type TContactInfo = Pick<IOrder, 'email' | 'phone'>;
```
Список идентификаторов выбранных товаров
```typescript
export type TOrderedItems = Pick<IItem, 'id'>[];
```
Данные о товаре в корзине
```typescript
export type TBasketItem = Pick<IItem, 'id' | 'title' | 'price'>;
```

## Архитектура
Код разделен на слои согласно парадигме MVP:
- Model - слой данных, отвечает за хранение и изменение данных
- View - слой представления, отвечает за отображение данных на странице
- Presenter - презентер, отвечает за связь слоя данных и слоя представления
### Базовый код

#### Класс `Api`
Содержит базовую логику отправки запросов. В конструктор передается базовый адрес сервера и объект с заголовками запросов. Методы: 
- `get` - выполняет GET запрос на переданный в параметрах адрес и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на адрес, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс `EventEmitter`
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Компоненты слоя данных

#### Класс `CatalogModel`
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает объект брокера событий.\
В полях класса хранятся следующие данные:
- `total: number` - число видов товаров
- `_items: IItem[]` - массив объектов товаров
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы класса:
- `addItem(item: IItem): void` - добавляет один товар в массив и вызывает событие изменение массива
- `getItem(id: string): IItem` - возвращает товар по его `id`
- `deleteItem(id: string): void` - удаляет товар по его `id` из массива и вызывает событие изменение массива

#### Класс `OrderModel`
Класс отвечает за хранение и логику работы с даными оформления заказа.\
Конструктор класса принимает объект брокера событий.\
В полях класса хранятся следующие данные:
- `payment: TPayment | undefined` - вид оплаты товара
- `email: string` - контактный email пользователя
- `phone: string` - контактный телефон пользователя
- `address: string` - адрес заказа
- `total: number | null` - сумма заказа
- `items: IItem[]` - массив товаров
- `ordered: TOrderedItems` - массив идентификаторов товаров
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы класса:
- `validate(data: Record<keyof TOrderInfo, string>|Record<keyof TContactInfo, string>): boolean` - проверяет данные о заказе на валидность
- `addItem(item: IItem): void` - добавляет товар в массив товаров и вызывает событие изменение массива
- `getItem(id: string): IItem` - возвращает товар по его `id` из массива товаров
- `removeItem(id: string): void` - убирает товар по его `id` из массива товаров и вызывает событие изменение массива
- `clearOrder(): void` - убирает все товары из массива товаров и вызывает событие изменение массива
- `getOrder(): IOrder` - возвращает объект заказа

### Компоненты слоя отображения
#### Класс `View`
Базовый класс слоя отображения, наследуется другими классами, реализует метод отображения элемента:
- `render(): void`
Создает в конструкторе и хранит HTML-элемент:
- `element: HTMLElement`

#### Класс `Page`
Реализует главную страницу. Наследуется от `View`.\
Поля:
- `counter: number` - счетчик товаров в корзине
- `catalog: HTMLElement[]` - элемент каталога, в который добавляются карточки товаров
- `locked: boolean` - состояние прокрутки страницы

#### Класс `ItemView`
Реализует карточку товара. Наследуется от `View`.

#### Класс `CatalogView`
Реализует каталог товаров, хранит в себе масстив элементов карточек. Наследуется от `View`.\
- `content: HTMLElement[]` - массив с элементами карточек товаров

#### Класс `BasketItemView`
Реализует карточку товара в корзине. Наследуется от `View`.\
- `counter?: number` - номер карточки в корзине

#### Класс `BasketView`
Реализует корзину. Наследуется от `View`.
- `content: HTMLElement[]` - массив элементов карточек товаров в корзине

#### Класс `Modal`
Класс для реализации модальных окон, наследуется другими классами. Наследуется от `View`.\
Поля:
- `modal: HTMLElement` - содержит элемент модального окна
- `button?: HTMLButtonElement` - содержит кнопку модального окна

Методы:
- `open(): void` - открывает модальное окно
- `close(): void` - закрывает модальное окно
- `onClick(fn: Function): void` - устанавливает функцию-обработчик клика

#### Класс `ItemModal`
Реализует модальное окно с карточкой товара. Наследуется от `Modal`.

#### Класс `FormModal`
Реализует модальное окно с формой. Наследуется от `Modal`. Содержит поля и методы для работы с формой.\
Поля:
- `form: HTMLFormElement` - содержит элемент формы
- `inputs: HTMLInputElement[]` - массив полей ввода
- `errors: HTMLElement[]` - массив элементов, выводящих ошибки валидации полей
- `submitButton: HTMLButtonElement` - кнопка отправки данных формы

Методы:
- `setValid(isValid: boolean): void` - устанавливает валидацию формы
- `setError(data: string): void` - устанавливает ошибку валидации поля
- `showError(errorElement: HTMLElement): void` - показывает ошибку валидации поля
- `hideError(errorElement: HTMLElement): void` - скрывает ошибку валидации поля
- `getInputValues(): Record<string, string>` - возвращает объект с данными полей ввода
- `onSubmit(fn: Function): void` - устанавливает функцию-обработчик отправки формы

#### Класс `SuccessModal`
Реализует модальное окно успешной покупки. Наследуется от `Modal`.

### Компоненты слоя представления
#### Класс `Presenter`
Реализует логику работы приложения, связывает слой модели со слоем отображения.