# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```bash
npm install
npm run start
```

или

```bash
yarn
yarn start
```
## Сборка

```bash
npm run build
```

или

```bash
yarn build
```

## Данные и типы данных
Карточка товара
```typescript
export interface IItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```
Каталог товаров
```typescript
export interface ICatalog {
  total: number;
  items: IItem[];
}
```
Заказ
```typescript
export interface IOrder {
  payment: TPayment | undefined;
  email: string;
  phone: string;
  address: string;
  total: number | null;
  items: IItem[];
}
```
Заказ, отправляемый на сервер
```typescript
export interface IOrderFinished {
  payment: TPayment | undefined;
  email: string;
  phone: string;
  address: string;
  total: number | null;
  items: string[];
}
```
Ответ сервера об успешном заказе
```typescript
export interface IOrderResult {
  id: string;
  total: number | null;
}
```
Ответ сервера об ошибке
```typescript
export interface IErrorResponse {
  error: string;
}
```
Общий ответ от сервера
```typescript
export type TServerResponse = Partial<IOrderResult> & Partial<IErrorResponse>;
```
Тип оплаты заказа
```typescript
export type TPayment = 'online' | 'offline';
```
Данные для модального окна об успешной оплате заказа
```typescript
export type TSuccessDescription = {payment: TPayment, total: number};
```
Объект настроек
```typescript
export interface IOptions {
  events: Record<string, string>,
  screens: Record<string, string>,
  blocks: Record<string, string>,
  regex: Record<string, RegExp>,
}
```

## Архитектура
Код разделен на слои согласно парадигме MVP:
- Model - слой данных, отвечает за хранение и изменение данных
- View - слой представления, отвечает за отображение данных на странице
- Presenter - презентер, отвечает за связь слоя данных и слоя представления
### Базовый код

#### Класс `Api`
Содержит базовую логику отправки запросов. В конструктор передается базовый адрес сервера и объект с заголовками запросов.\
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах адрес и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на адрес, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс `LarekApi`
Наследуется от класса `Api`. Реализует взаимодействие с сервером.\
Методы:
- `getItemList: () => Promise<IItem[]>` - возвращает список товаров с сервера
- `getItem: (id: string) => Promise<IItem>` - возвращает один объект товара по его идентификатору
- `makeOrder(order: IOrderFinished): Promise<TServerResponse>` - отправляет готовый заказ на сервер

#### Класс `EventEmitter`
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Компоненты слоя данных

#### Класс `Model<T>`
Базовый класс слоя данных. Наследуется другими классами данного слоя. Конструктор принимает данные с переменным типом `<T>` и объект брокера событий. Связывает данные с экземпляром класса.\
Метод `emitChanges` - инициализирует событие и отправляет объект данных.

#### Класс `CatalogModel`
Наследуется от `Model<T>`. Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает объект брокера событий.\
В полях класса хранятся следующие данные:
- `total: number` - число видов товаров
- `items: IItem[]` - массив объектов товаров

Методы класса:
- `addItem(item: IItem): void` - добавляет один товар в массив и вызывает событие изменение массива
- `setItems(item: IItem[]): void` - заменяет массив товаров и вызывает событие изменение массива
- `getItem(id: string): IItem` - возвращает товар по его `id`
- `deleteItem(id: string): void` - удаляет товар по его `id` из массива и вызывает событие изменение массива

#### Класс `BasketModel`
Наследуется от `Model<T>`. Класс отвечает за хранение и логику работы с даными оформления заказа.\
Конструктор класса принимает массив данных, объект брокера событий, объект настроек.\
В полях класса хранятся следующие данные:
- `payment: TPayment | undefined` - вид оплаты товара
- `email: string` - контактный email пользователя
- `phone: string` - контактный телефон пользователя
- `address: string` - адрес заказа
- `total: number | null` - сумма заказа
- `items: IItem[]` - массив товаров
- `emailRe: RegExp` - регулярное выражение для валидации электронной почты
- `phoneRe: RegExp` - регулярное выражение для валидации телефона

Методы класса:
- `validate(data: Partial<IOrder>): boolean` - проверяет данные о заказе на валидность
- `addItem(item: IItem): void` - добавляет товар в массив товаров и вызывает событие изменение массива
- `getItem(id: string): IItem` - возвращает товар по его `id` из массива товаров
- `removeItem(id: string): void` - убирает товар по его `id` из массива товаров и вызывает событие изменение массива
- `getTotal(): number` - возвращает сумму заказа
- `clearOrder(): void` - убирает все товары из массива товаров и вызывает событие изменение массива
- `getOrder(): IOrderFinished` - возвращает объект готового заказа

### Компоненты слоя отображения
#### Класс `View<T>`
Базовый класс слоя отображения, наследуется другими классами. Конструктор принимает контейнер-HTMLElement.\
Методы: 
- `render(data?: Partial<T>): HTMLElement` - реализует метод отображения элемента
- `toggleClass(element: HTMLElement, className: string, force?: boolean):void` - добавляет или убирает класс элемента
- `setText(element: HTMLElement, value: unknown):void` - устанавливает текст элемента
- `setDisabled(element: HTMLElement, state: boolean):void` - включает или выключает интерактивность элемента
- `setHidden(element: HTMLElement):void` - прячет элемент
- `setVisible(element: HTMLElement):void` - показывает элемент
- `setImage(element: HTMLImageElement, src: string, alt?: string):void` - устанавливает ссылку и альтернативный текст изображения на элемент

#### Класс `Page`
Реализует главную страницу. Наследуется от `View`.\
Конструктор принимает элемент-контейнер и объект брокера событий.\
Поля:
- `counter: number` - счетчик товаров в корзине
- `catalog: HTMLElement[]` - элемент каталога, в который добавляются карточки товаров
- `locked: boolean` - состояние прокрутки страницы

#### Класс `Card<T>`
Реализует карточку товара. Наследуется от `View`.
Поля:
- `id: string` - идентификатор товара
- `title: string` - заголовок товара
- `image?: string` - изображение товара
- `description?: string` - описание товара
- `category?: string` - категория товара
- `price?: number | null` - цена товара

#### Класс `BasketItemView`
Реализует карточку товара в корзине. Наследуется от `View`.\
Конструктор принимает элемент-контейнер.\
Поля:
- `id: string` - идентификатор товара
- `title: string` - заголовок товара
- `index: number` - номер товара в списке корзины
- `price: number | null` - цена товара

Методы:
- `setButtonAction(actions: IViewActions): void` - устанавливает колбек на кнопку
- `getItem(): HTMLElement` - возвращает карточку товара корзины

#### Класс `BasketView`
Реализует корзину. Наследуется от `View`.\
Конструктор принимает имя блока, элемент-контейнер, объект брокера событий, функцию-колбек.\
Поля:
- `total: number` - сумма товаров
- `list: HTMLElement|HTMLElement[];` - элемент-список товаров

Методы:
- `toggleButton(value: boolean): void` - включает или выключает кнопку

#### Класс `Modal`
Класс для реализации модального окна. Наследуется от `View`.\
Поля:
- `content: HTMLElement | null` - содержимое модального окна
- `_button?: HTMLButtonElement` - кнопка действия модального окна

Методы:
- `open(): void` - открывает модальное окно
- `close(): void` - закрывает модальное окно

#### Класс `ItemPreview`
Реализует содержимое модального окна с карточкой товара. Наследуется от `View`.\
Конструктор принимает имя блока, элемент-контейнер, объект брокера событий, функцию-колбек.\
Поля:
- `id: string` - идентификатор товара
- `title: string` - заголовок товара
- `image: string` - изображение товара
- `description: string|string[]` - описание товара
- `category: string` - категория товара
- `price: number | null` - цена товара

#### Класс `FormModal`
Реализует содержимое модального окна с формой. Наследуется от `View`. Содержит поля и методы для работы с формой.\
Конструктор принимает имя блока, элемент-контейнер, объект брокера событий, функцию-колбек.\
Поля:
- `error: string` - текст ошибки валидации

Методы:
- `selectPayment(name: string): void` - делает активной выбранную кнопку метода оплаты, если такая имеется
- `toggleButton(value: boolean): void` - включает или выключает кнопку действия

#### Класс `SuccessView`
Реализует модальное окно успешной покупки. Наследуется от `View`.\
Конструктор принимает имя блока, элемент-контейнер, функцию-колбек.\
Поля:
- `description: TSuccessDescription;` - устанавливает текст успешной оплаты и сумму закза

### Компоненты слоя представления
#### Класс `Presenter`
Реализует логику работы приложения, связывает слой модели со слоем отображения.\
Конструктор принимает объект api, объект брокера событий, объект настроек. В полях содержатся экземпляры других классов, необходимые для работы приложения.\
Методы:
- `init(): void` - инициализирует работу программы